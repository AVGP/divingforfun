<html>

<head>
  <title>Calculate Nitrox mixture</title>
  <meta name="description"
    content="This tool lets you calculate Nitrox gas mixtures based on the current tank content and the mix used to fill.">
  <meta name="viewport" content="width=device-width">
  <style>
    body {
      margin: 1em;
      font-family: Arial, Helvetica, sans-serif;
    }

    fieldset {
      margin: 0.3em;
    }

    .warning {
      border: 1px solid red;
      padding: 0.1em 1em;
    }
  </style>
</head>

<body>
  <h1>Calculate Nitrox mix</h1>
  <div class="warning">
    <h2>Warning!</h2>
    <p>
      This tool is for convenience. It is provided as is and may be faulty.
      <strong>It does not replace measuring of the oxygen content of the bottle!</strong>
    </p>
    <p>
      Use this at your own risk!
    </p>
  </div>

  <h2>Calculator</h2>
  The form below lets you calculate the expected mixture generated by filling a tank with known mixture with a known
  other mixture to a given end pressure.
  It only provides an approximation and you <strong>always have to measure the actual tank content</strong> after
  filling with an O2 analyzer!
  <fieldset>
    <legend>
      Current tank info
    </legend>
    <p>
      <label>
        Tank volume
        <input id="vol" type="number" min="0" max="40" step="1" value="12" maxlength="3"> liter
      </label>
    </p>
    <p>
      <label>
        Current tank pressure
        <input id="startPressure" type="number" min="0" max="300" value="100" maxlength="3"> bar
      </label>
    </p>
    <p>
      <label>
        Current oxygen content
        <input id="startO2" value="21" type="number" min="0" max="100" step="1" maxlength="3"> %
      </label>
    </p>
  </fieldset>
  <fieldset>
    <legend>Filling info</legend>
    <p>
      <label>
        Final pressure
        <input id="endPressure" type="number" value="210" min="0" max="300" step="5" maxlength="3"> bar
      </label>
    </p>
    <p>
      <label>
        Filling oxygen content
        <input id="fillO2" type="number" value="21" min="0" max="100" step="1" maxlength="3"> %
      </label>
    </p>
  </fieldset>
  <button type="button">Calculate</button>
  <h2>Resulting mix</h2>
  <table>
    <thead>
      <tr>
        <th>Oxygen content</th>
        <th>MOD (ppO<sub>2</sub>=1.4)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="o2"></td>
        <td id="mod"></td>
      </tr>
    </tbody>
  </table>
  <script>
    document.querySelector('button').addEventListener('click', function () {
      // get all the numbers from the DOM
      const tankVol = parseFloat(document.getElementById('vol').value);
      const startPress = parseFloat(document.getElementById('startPressure').value);
      const o2Start = parseFloat(document.getElementById('startO2').value);
      const endPress = parseFloat(document.getElementById('endPressure').value);
      const o2Fill = parseFloat(document.getElementById('fillO2').value);

      // how much O2 in total?
      const fillPress = endPress - startPress;
      const totalO2Vol = (tankVol * startPress * (o2Start / 100.0)) + (tankVol * fillPress * (o2Fill / 100.0));

      const o2ContentEnd = (totalO2Vol / (tankVol * endPress));
      document.getElementById('o2').textContent = (o2ContentEnd * 100.0).toPrecision(2) + ' %';
      document.getElementById('mod').textContent = (((1.4 / o2ContentEnd) - 1).toPrecision(2) * 10) + 'm';
    });
  </script>
</body>

</html>