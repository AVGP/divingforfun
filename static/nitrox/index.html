<!doctype html>
<html lang="en">
<head>
  <title>Calculate Nitrox mixture</title>
  <meta name="description"
    content="This tool lets you calculate Nitrox gas mixtures based on the current tank content and the mix used to fill.">
  <meta name="viewport" content="width=device-width">
  <meta name="theme-color" content="#19d1f1">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">  
  <link rel="manifest" href="/nitrox/manifest.webmanifest">
  <link rel="apple-touch-icon" href="/nitrox/icon-192x192.png">
  <style>
    body {
      margin: 1em;
      font-family: Arial, Helvetica, sans-serif;
    }

    fieldset {
      margin: 0.3em;
    }

    .warning {
      border: 1px solid red;
      padding: 0.1em 1em;
    }
    
    th, td { padding: 0.5em; }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://maxcdn.bootstrapcdn.com">
  <link rel="preconnect" href="https://maxcdn.bootstrapcdn.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
  <link rel="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="nitrox.css">

</head>

<body>
  <h1>Calculate Nitrox mix</h1>
  <div class="warning">
    <h2>Warning!</h2>
    <p>
      This tool is for convenience. It is provided as is and may be faulty.
      <strong>It does not replace measuring of the oxygen content of the bottle!</strong>
    </p>
    <p>
      Use this at your own risk!
    </p>
  </div>

  <h2>Calculator</h2>
  The form below lets you calculate the expected mixture generated by filling a tank with known mixture with a known
  other mixture to a given end pressure.
  It only provides an approximation and you <strong>always have to measure the actual tank content</strong> after
  filling with an O2 analyzer!

  <details open>
    <summary>Current tank content</summary>
    <div class="input-group">
      <label>
        Current tank pressure (bar)
        <input id="startPressure" type="number" min="0" max="300" value="100" maxlength="3">
      </label>
    </div>
    <div class="input-group">
      <label>
        Current oxygen content (%)
        <input id="startO2" value="21" type="number" min="0" max="100" step="1" maxlength="3">
      </label>
    </div>
  </details>
  <details open>
    <summary>Filling information</summary>
    <div class="input-group">
      <label>
        Final pressure (bar)
        <input id="endPressure" type="number" value="210" min="0" max="300" step="5" maxlength="3">
      </label>
    </div>
    <div class="input-group">
      <label>
        Filling oxygen content (%)
        <input id="fillO2" type="number" value="21" min="0" max="100" step="1" maxlength="3">
      </label>
    </div>
  </details>

  <button id="mix" type="button">Calculate</button>
  <h2>Resulting mix</h2>
  <table>
    <thead>
      <tr>
        <th>Oxygen content</th>
        <th>MOD (ppO<sub>2</sub>=1.4)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="o2"></td>
        <td id="mod"></td>
      </tr>
    </tbody>
  </table>

  <h1> Equivalent Air Depth</h1>

  <p>Calculate the equivalent depth of a Nitrox five when using air tables.</p>
  <p>
    <label>
      Dive depth (m)
      <input id="depth" type="number" value="30" min="1" max="999">
    </label>
  </p>
  <p>
    <label>
      O2 content (%)
      <input id="ead-o2" type="number" value="32" min="1" max="99">
    </label>
  </p>
<button id="ead" type="button">Calculate equivalent air depth</button>
<p id="ead-result"></p>

  <script>
  if(!location.href.match('/nitrox/$')) location.href = '/nitrox/';
  if(!location.href.match('^https')) location.href = 'https://divingfor.fun/nitrox/';

    document.querySelector('button#mix').addEventListener('click', function () {
      // get all the numbers from the DOM
      const startPress = parseFloat(document.getElementById('startPressure').value);
      const o2Start = parseFloat(document.getElementById('startO2').value);
      const endPress = parseFloat(document.getElementById('endPressure').value);
      const o2Fill = parseFloat(document.getElementById('fillO2').value);

      // how much O2 in total?
      const fillPress = endPress - startPress;
      const totalO2Vol = (startPress * (o2Start / 100.0)) + (fillPress * (o2Fill / 100.0));

      const o2ContentEnd = (totalO2Vol / (endPress));
      document.getElementById('o2').textContent = (o2ContentEnd * 100.0).toPrecision(2) + ' %';
      document.getElementById('mod').textContent = (((1.4 / o2ContentEnd) - 1).toPrecision(2) * 10) + 'm';
    });

    document.getElementById('ead').addEventListener('click', function() {
      const depth = parseFloat(document.getElementById('depth').value);
      const o2Frac = parseFloat(document.getElementById('ead-o2').value) / 100;
      
      // (Depth + 10) × Fraction of N2 / 0.79 − 10
      const ead = (depth + 10) * (1 - o2Frac)/0.79 - 10;
      document.getElementById('ead-result').textContent = ead.toFixed(2) + 'm';
    });
    if('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/nitrox/sw.js');
      });
    }
  </script>
</body>

</html>
